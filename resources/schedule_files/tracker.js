!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1);r(2);var o=r(3),i=r(3),s=r(4),a=r(13),u=r(18),c=r(19),l=r(20),d=r(22),f=r(23),h=r(9),p=r(27);r(26);var m=r(17),v=function(){function e(e){var t=this;this._previousRequestPromise=null,this.createRequestsCounter=0,this.process=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=Array.prototype.slice.call(e);t.invoke(n.shift(),n)},this.isPrerenderOrPreview=function(){var e=t._window.document.visibilityState||t._window.document.webkitVisibilityState||"visible";return"preview"==e||"prerender"==e},this.invoke=function(e,r){try{if(!e)throw new Error("methodName required");if("create"!==e&&!t._settings)throw new Error('You should call "create" first');if("create"!==e&&(!t._cookieManager.isCookieEnabled()||t.isPrerenderOrPreview()))return;if("create"===e)return void t.tryCreate(r[0]);if("getDiagnosticsInfo"===e&&r[0]instanceof Function)return void t.getDiagnosticsInfo(r[0]);var n=t.moduleManager.tryGetModuleCommand(e);if(null!=n)return void t.moduleManager.invokeModule(n,r);var o=e.replace(".","_");if(void 0===t[o])throw new Error("Unknown method: "+o);r instanceof Array?t.then(function(){return t[o].apply(t,r)}):t.then(function(){return t[o].call(t,r)})}catch(e){t.logErrorWithDataFromTracker(e)}},this.then=function(e){t._sessionStorage.deviceUUIDIsSet()?e().then(void 0,function(e){return t.logErrorWithDataFromTracker(e)}):null==t._previousRequestPromise?t._previousRequestPromise=e().then(void 0,function(e){return t.logErrorWithDataFromTracker(e)}):t._previousRequestPromise=t._previousRequestPromise.then(function(){return e()}).then(void 0,function(e){return t.logErrorWithDataFromTracker(e)})},this.getTrackerAdditionalData=function(){var e=null;try{e=t._sessionStorage.tryGetDeviceUUID()}catch(e){}return{Version:o.version,"Point of contact":t._settings.pointOfContactSystemName,Endpoint:t._settings.endpointId,Origin:location.origin,DeviceUUID:e}},this.logErrorWithDataFromTracker=function(e,r){var o=t.getTrackerAdditionalData(),i=e;i.requestId&&(o.RequestId=i.requestId),t._logger.logError(e,n.__assign(n.__assign({},o),r))},this.trackEventWithDataFromTracker=function(e,r){var o=t.getTrackerAdditionalData();t._logger.trackEvent(e,n.__assign(n.__assign({},o),r))},this.getDiagnosticsInfo=function(e){e({createRequestsCount:t.createRequestsCounter,endpointId:null!=t._settings?t._settings.endpointId:null})},this.tryCreate=function(e){if(++t.createRequestsCounter,t._previousRequestPromise){var r=d.compareSettings(t._settings,e);null!=r&&t.logErrorWithDataFromTracker(new m.MultipleCallsToCreateError(r))}else t.create(e)},this.create=function(e){t._settings=e||{},null==t._settings.serviceDomain||"tracker.directcrm.ru"===t._settings.serviceDomain?t._settings.serviceDomain=i.getDefaultServiceDomain():"tracker.staging.directcrm.ru"===t._settings.serviceDomain&&(t._settings.serviceDomain="api.staging.directcrm.ru"),t._window=t._settings.windowOverride?t._settings.windowOverride:window,t._cookieManager=new u.Manager(t._window),t._cookieManager.setBaseDomain(),t._sessionStorage=new c.CustomerSessionStorage(t._cookieManager,t._window),t._sender=new s.RequestSender(t._sessionStorage,t._settings.serviceDomain,t._settings.projectDomain,t._settings.useHttp,t._settings.crossDomainRequestFactoryOverride),t._logger=null==t._settings.loggerOverride?new l.TrackerLogger:t._settings.loggerOverride,t.timeZoneProvider=null==t._settings.timeZoneProviderOverride?new p.IanaTimeZoneProvider:t._settings.timeZoneProviderOverride;var r={logError:t.logErrorWithDataFromTracker,trackEvent:t.trackEventWithDataFromTracker};if(t.moduleManager=new f.ModuleManager(t._settings,t._sessionStorage,function(){return t._previousRequestPromise},r),t._cookieManager.isCookieEnabled()&&!t.isPrerenderOrPreview()){var n=null!=t._window.location.search&&-1!==t._window.location.search.indexOf("s=");if(t._previousRequestPromise=(n?t.attemptRedirect():t.trackVisit()).then(void 0,function(e){return t.logErrorWithDataFromTracker(e)}),t._settings.keepAlive)var o=setInterval(function(){t._previousRequestPromise=t._previousRequestPromise.then(function(){return t.keepAlive()}).then(void 0,function(e){e&&e instanceof a.Timeout||clearInterval(o),t.logErrorWithDataFromTracker(e)})},3e5)}},this.attemptRedirect=function(){var e={options:{pointOfContactSystemName:t._settings.pointOfContactSystemName},originDomain:t._window.document.location.host,requestUrl:t._window.document.location.href};return null!=t._settings.endpointId&&(e.endpointId=t._settings.endpointId),t._sender.sendToTrackerWithoutSessionAndGetResult("/v1.1/redirect",e).then(function(e){null!=e.redirectUrl?t._window.location.replace(e.redirectUrl):t.trackVisit()})},this.validateOperationParameters=function(e){if(!e)throw new Error("parameters required");if(!e.operation)throw new Error("operation required")},this.createV3Request=function(e){var r={originDomain:t._window.location.host,deviceUUID:t._sessionStorage.tryGetDeviceUUID(),operation:e.operation,ianaTimeZone:t.timeZoneProvider.tryGetTimeZone()};return null!=t._settings.endpointId&&(r.endpointId=t._settings.endpointId),e.data&&(r.data=JSON.stringify(e.data)),{request:r,additionalParameters:Object.keys(e).filter(function(e){return"operation"!=e&&"data"!=e&&"onSuccess"!=e&&"onValidationError"!=e&&"onError"!=e}).map(function(t){return{name:t,value:e[t]}})}},this.fillMessageData=function(e){var r=t._sessionStorage.tryGetDeviceUUID();if(null!=r&&""!=r)if("undefined"!=r)e.session={deviceGuid:r};else{t.logErrorWithDataFromTracker(new Error("deviceUUID = "+r)),t._cookieManager.remove("mindboxDeviceUUID"),t._cookieManager.remove("directCrm-session");try{t._window.localStorage.removeItem("directCrm-session")}catch(e){}}e.options={pointOfContactSystemName:t._settings.pointOfContactSystemName},null!=t._settings.endpointId&&(e.endpointId=t._settings.endpointId),e.originDomain=t._window.document.location.host;try{e.screenResolution=window.screen.width+"x"+window.screen.height}catch(e){}};try{this._previousRequestPromise=void 0;for(var r=0;r<e.length;++r){"create"==(h=Array.prototype.slice.call(e[r]))[0]&&(this.invoke(h.shift(),h),e.splice(r,1))}for(r=0;r<e.length;++r){var h=Array.prototype.slice.call(e[r]);this.invoke(h.shift(),h)}}catch(e){this.logErrorWithDataFromTracker(e)}}return e.initialize=function(){if(window.mindboxInitialized)throw new Error("Multiple attepmts to initialize tracker. Look for duplicate mindbox script-blocks.");var t=new e(null!=window.mindbox&&null!=window.mindbox.queue?window.mindbox.queue:null!=window.directCrm&&null!=window.directCrm.Queue?window.directCrm.Queue:new Array);window.mindbox=t.process,window.mindboxInitialized=!0,window.directCrm=t.process},e.dispose=function(){delete window.mindbox,delete window.mindboxInitialized,delete window.directCrm},e.prototype.trackVisit=function(){var e={requestUrl:this._window.document.location.href,referrerUrl:this._window.document.referrer,ianaTimeZone:this.timeZoneProvider.tryGetTimeZone()};return this._settings.redirectedFrom&&(this._settings.redirectedFrom.requestUrl||this._settings.redirectedFrom.referrerUrl)&&(e.redirectedFrom={requestUrl:this._settings.redirectedFrom.requestUrl,referrerUrl:this._settings.redirectedFrom.referrerUrl}),this.fillMessageData(e),this._sender.sendToTrackerAndForget("/v1.1/customer/track-visit",e)},e.prototype.keepAlive=function(){var e={};return this.fillMessageData(e),this._sender.sendToTrackerAndForget("/v1.1/customer/keep-alive",e)},e.prototype.sync=function(e){var t=this;if(this.validateOperationParameters(e),e.onSuccess&&"function"!=typeof e.onSuccess)throw new Error("onSuccess should be a function");if(e.onValidationError&&"function"!=typeof e.onValidationError)throw new Error("onValidationError should be a function");if(e.onError&&"function"!=typeof e.onError)throw new Error("onError should be a function");var r=this.createV3Request(e),o=r.request,i=r.additionalParameters,s=function(r){e.onError&&e.onError(r),t.logErrorWithDataFromTracker(r)};return this._sender.sendToTrackerAndGetResult("/v3/js/operations/sync",o,i).then(function(t){if(h.ServiceResponses.isSuccess(t)){if(e.onSuccess){var r=n.__assign({},t);delete r.deviceUUID,delete r.requestId,delete r.status,e.onSuccess(r)}}else if(h.ServiceResponses.isValidationError(t))if(e.onValidationError)e.onValidationError(t.validationMessages);else{var o={name:"Unhandled validation error",message:JSON.stringify(t.validationMessages),requestId:t.requestId};s(o)}else s({name:"Malformed server response",message:JSON.stringify(t)})},s)},e.prototype.async=function(e){var t=this;if(this.validateOperationParameters(e),e.onSuccess&&"function"!=typeof e.onSuccess)throw new Error("onSuccess should be a function");if(e.onError&&"function"!=typeof e.onError)throw new Error("onError should be a function");var r=this.createV3Request(e),n=r.request,o=r.additionalParameters;return this._sender.sendToTrackerAndForget("/v3/js/operations/async",n,o).then(function(){e.onSuccess&&e.onSuccess()},function(r){e.onError&&e.onError(r),t.logErrorWithDataFromTracker(r)})},e.prototype.authenticate=function(e){var t={ticket:e};return this.fillMessageData(t),this._sender.sendToTrackerAndForget("/v1.1/customer/authenticate/by-ticket",t)},e.prototype.identify=function(e){var t=this;if(!e)throw new Error("parameters required");if(!e.operation)throw new Error("operation required");if(!e.identificator)throw new Error("identificator required");if(!e.identificator.provider)throw new Error("provider required");if(!e.identificator.identity)throw new Error("identity required");var r={operation:e.operation,identity:e.identificator.identity,provider:e.identificator.provider,ianaTimeZone:this.timeZoneProvider.tryGetTimeZone()};e.data&&(r.data=JSON.stringify(e.data)),this.fillMessageData(r);var n=e.success&&"function"==typeof e.success?e.success:function(){},o=e.error&&"function"==typeof e.error?e.error:function(e){};return this._sender.sendToTrackerAndForget("/v1.1/customer/identify",r).then(n,function(e){o(e),t.logErrorWithDataFromTracker(e)})},e.prototype.performOperation=function(e){var t=this;if(!e)throw new Error("parameters required");var r=e.success&&"function"==typeof e.success?e.success:function(){},n=e.error&&"function"==typeof e.error?e.error:function(e){},o={operationSystemName:"string"==typeof e?e:e.operation};return this.fillMessageData(o),e.data&&(o.data=JSON.stringify(e.data)),this._sender.sendToTrackerAndForget("/v1.1/customer/track-event",o).then(r,function(e){n(e),t.logErrorWithDataFromTracker(e)})},e.prototype.closeSession=function(){var e={};return this.fillMessageData(e),this._sender.sendToTrackerAndForget("/v1.1/customer/close-session",e)},e.prototype.order_create=function(e){var t={order:e};return this.fillMessageData(t),this._sender.sendToTrackerAndForget("/v1.1/order/create",t)},e.prototype.cart_addProduct=function(e){var t={item:e};return this.fillMessageData(t),this._sender.sendToTrackerAndForget("/v1.1/cart/add-product",t)},e.prototype.cart_removeProduct=function(e){var t={item:e};return this.fillMessageData(t),this._sender.sendToTrackerAndForget("/v1.1/cart/remove-product",t)},e.prototype.cart_setProductQuantity=function(e){var t={item:e};return this.fillMessageData(t),this._sender.sendToTrackerAndForget("/v1.1/cart/set-product-quantity",t)},e.prototype.cart_clear=function(){var e={};return this.fillMessageData(e),this._sender.sendToTrackerAndForget("/v1.1/cart/clear",e)},e.prototype.getSegments=function(e,t){if(!e)throw new Error("OperationName required");if(!t)throw new Error("Callback required");var r={operation:e,DirectCrmBrand:this._settings.brandSystemName,DirectCrmPointOfContactSystemName:this._settings.pointOfContactSystemName};return this._sender.sendToDirectCrm("/v3/customers/current/segments",r).then(function(e){try{t(e)}catch(e){console.error(e)}})},e}();t.Tracker=v,v.initialize()},function(e,t,r){"use strict";r.r(t),r.d(t,"__extends",function(){return o}),r.d(t,"__assign",function(){return i}),r.d(t,"__rest",function(){return s}),r.d(t,"__decorate",function(){return a}),r.d(t,"__param",function(){return u}),r.d(t,"__metadata",function(){return c}),r.d(t,"__awaiter",function(){return l}),r.d(t,"__generator",function(){return d}),r.d(t,"__exportStar",function(){return f}),r.d(t,"__values",function(){return h}),r.d(t,"__read",function(){return p}),r.d(t,"__spread",function(){return m}),r.d(t,"__spreadArrays",function(){return v}),r.d(t,"__await",function(){return g}),r.d(t,"__asyncGenerator",function(){return y}),r.d(t,"__asyncDelegator",function(){return w}),r.d(t,"__asyncValues",function(){return _}),r.d(t,"__makeTemplateObject",function(){return b}),r.d(t,"__importStar",function(){return D}),r.d(t,"__importDefault",function(){return S});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function o(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var i=function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function s(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}function a(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s}function u(e,t){return function(r,n){t(r,n,e)}}function c(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function l(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(s,a)}u((n=n.apply(e,t||[])).next())})}function d(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function f(e,t){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}function h(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function p(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function m(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}function v(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n}function g(e){return this instanceof g?(this.v=e,this):new g(e)}function y(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(e,t||[]),i=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(e){o[e]&&(n[e]=function(t){return new Promise(function(r,n){i.push([e,t,r,n])>1||a(e,t)})})}function a(e,t){try{(r=o[e](t)).value instanceof g?Promise.resolve(r.value.v).then(u,c):l(i[0][2],r)}catch(e){l(i[0][3],e)}var r}function u(e){a("next",e)}function c(e){a("throw",e)}function l(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function w(e){var t,r;return t={},n("next"),n("throw",function(e){throw e}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,o){t[n]=e[n]?function(t){return(r=!r)?{value:g(e[n](t)),done:"return"===n}:o?o(t):t}:o}}function _(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=h(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,o){(function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)})(n,o,(t=e[r](t)).done,t.value)})}}}function b(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function D(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function S(e){return e&&e.__esModule?e:{default:e}}},function(e,t){!function(e){"use strict";e.console=e.console||{};for(var t,r,n=e.console,o={},i=function(){},s="memory".split(","),a="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");t=s.pop();)n[t]||(n[t]=o);for(;r=a.pop();)n[r]||(n[r]=i)}("undefined"==typeof window?this:window)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="0.45.68";t.getDefaultServiceDomain=function(){return-1!="api.mindbox.ru".indexOf("serviceDomainDefinedByDeployment")?"api.mindbox.ru":"api.mindbox.ru"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5),o=r(3),i=r(11),s=function(){function e(e,t,r,o,i){this._sessionStorage=e,this._serviceDomain=t,this._projectDomain=r,this._useHttp=o||!1,this._crossDomainRequestFactory=i||n.CrossDomainRequestFactory}return e.prototype.getProtocol=function(){return this._useHttp?"http://":"https://"},e.prototype.sendToTrackerAndForget=function(e,t,r){var n=this,o=this.createCrossDomainRequest(i.HttpMethods.POST,this._serviceDomain+e,t,r);return this._sessionStorage.deviceUUIDIsSet()&&this._sessionStorage.isUsingDeviceUUIDInLocalStorage()?o.sendAndForget():o.sendAndGetResult().then(function(e){return n.processResponse(e)})},e.prototype.sendToTrackerAndGetResult=function(e,t,r){var n=this;return this.createCrossDomainRequest(i.HttpMethods.POST,this._serviceDomain+e,t,r).sendAndGetResult().then(function(e){return n.processResponse(e),e})},e.prototype.sendToTrackerWithoutSessionAndGetResult=function(e,t){return this.createCrossDomainRequest(i.HttpMethods.POST,this._serviceDomain+e,t).sendAndGetResult()},e.prototype.createCrossDomainRequest=function(e,t,r,n){return t=this.getProtocol()+t+(t.match(/\?/)?"&":"?")+"version="+o.version,n&&n.length>0&&(t+="&"+n.map(function(e){return e.name+"="+e.value}).join("&")),this._crossDomainRequestFactory(e,t,r)},e.prototype.sendToDirectCrm=function(e,t){if(!this._projectDomain)throw new Error("You should initialize tracker with projectDomain property.");var r={deviceGuid:this._sessionStorage.tryGetDeviceUUID()};return t.customerSession=encodeURIComponent(JSON.stringify(r)),t.deviceUUID=this._sessionStorage.tryGetDeviceUUID(),this.createCrossDomainRequest(i.HttpMethods.GET,this._projectDomain+e,t).sendAndGetResult()},e.prototype.processResponse=function(e){if(!e.deviceUUID)throw new Error("Uncorrect server response: "+JSON.stringify(e));this._sessionStorage.setDeviceUUID(e.deviceUUID)},e}();t.RequestSender=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(6),o=r(9),i=r(11),s=r(12),a=r(13);t.CrossDomainRequestFactory=function(e,t,r){return new u(e,t,r)};var u=function(){function e(e,t,r){this.timeout=6e4,this._httpMethod=e,this._url=t,this._payload=s.PayloadSerializer.serialize(r)}return e.prototype.sendAndGetResult=function(){var e=this.sendViaXmlHttpRequest()||this.sendViaJsonp();if(null==e)throw new Error("Browser doesn't support big cross domain requests.");return e},e.prototype.sendAndForget=function(){var e=this.sendViaBeacon()||this.sendViaImage()||this.sendViaXmlHttpRequest();if(null==e)throw new Error("Browser doesn't support big cross domain requests.");return e},e.prototype.sendViaBeacon=function(){var t=e.appendQueryString(this._url,"transport=beacon");try{return void 0!==navigator.sendBeacon&&navigator.sendBeacon(t,this._payload)?n.Promise.resolve():null}catch(e){return null}},e.prototype.sendViaImage=function(){var t=this,r=e.appendQueryString(this._url,"transport=image&"+this._payload);if(r.length>e.maxUrlLength)return null;var o=document.createElement("img");o.width=1,o.height=1,o.src=r;var i=new n.Promise(function(e,t){o.onload=o.onerror=function(t){o.onload=null,o.onerror=null,e()}}),s=new n.Promise(function(e,r){setTimeout(function(){return r(new a.Timeout("Timeout in sendViaImage."))},t.timeout)});return n.Promise.race([i,s])},e.prototype.sendViaJsonp=function(){var t=this,r="Mindbox_jsonp_"+e.jsonpRequestNumber++,i=r+"resolve",s=e.appendQueryString(this._url,"transport=jsonp&"+this._payload+'&jsonpCallback=window["'+r+'"]');if(s.length>e.maxUrlLength)return null;var u=document.createElement("script");u.type="text/javascript",u.src=s;var c=new n.Promise(function(e){window[i]=e,window[r]=function(e){try{window[i](e)}finally{document.getElementsByTagName("head")[0].removeChild(u),u=null;try{delete window[r],delete window[i]}catch(e){window[r]=void 0,window[i]=void 0}}}});document.getElementsByTagName("head")[0].appendChild(u);var l=new n.Promise(function(e,r){setTimeout(function(){r(new a.Timeout("Timeout in sendViaJsonp."))},t.timeout)});return c=c.then(function(e){if(o.ServiceResponses.isError(e))throw new a.HttpError(e.httpStatusCode,e.errorMessage);return e}),n.Promise.race([c,l])},e.prototype.sendViaXmlHttpRequest=function(){if("undefined"==typeof XMLHttpRequest)return null;var t=new XMLHttpRequest;if(!("withCredentials"in t))return null;var r=e.appendQueryString(this._url,"transport=XmlHttpRequest");this._httpMethod==i.HttpMethods.GET&&(r=e.appendQueryString(r,this._payload)),t.open(this._httpMethod,r,!0),t.withCredentials=!0,t.timeout=this.timeout,t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var s=new n.Promise(function(e,r){t.onreadystatechange=function(){if(4==t.readyState)if(t.status>=200&&t.status<300)e(JSON.parse(t.responseText));else if(0==t.status)r(new a.Timeout("Timeout in sendViaXmlHttpRequest."));else{var n=void 0,i=void 0;try{var s=JSON.parse(t.responseText);o.ServiceResponses.isError(s)&&(n=s.errorMessage);var u=s;u.requestId&&(i=u.requestId)}catch(e){}r(new a.HttpError(t.status,n||t.responseText,i))}}});return this._httpMethod==i.HttpMethods.GET?t.send():t.send(this._payload),s},e.appendQueryString=function(e,t){return e+(e.match(/\?/)?"&":"?")+t},e.maxUrlLength=2036,e.jsonpRequestNumber=0,e}()},function(e,t,r){(function(t,r){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   4.0.5
 */
var n;n=function(){"use strict";function e(e){return"function"==typeof e}var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=0,i=void 0,s=function(e,t){d[o]=e,d[o+1]=t,2===(o+=2)&&(i?i(f):y())},a=("undefined"!=typeof window?window:void 0)||{},u=a.MutationObserver||a.WebKitMutationObserver,c="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),l="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,d=new Array(1e3);function f(){for(var e=0;e<o;e+=2){(0,d[e])(d[e+1]),d[e]=void 0,d[e+1]=void 0}o=0}var h,p,m,v,g,y=void 0;function w(e,t){var r=arguments,n=this,o=new this.constructor(D);void 0===o[b]&&N(o);var i,a=n._state;return a?(i=r[a-1],s(function(){return A(a,o,i,n._result)})):C(n,o,e,t),o}function _(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(D);return U(t,e),t}c?y=function(){return t.nextTick(f)}:u?(m=0,v=new u(f),g=document.createTextNode(""),v.observe(g,{characterData:!0}),y=function(){g.data=m=++m%2}):l?((p=new MessageChannel).port1.onmessage=f,y=function(){return p.port2.postMessage(0)}):(h=setTimeout,y=function(){return h(f,1)});var b=Math.random().toString(36).substring(16);function D(){}var S=void 0,E=1,k=2,T=new j;function P(e){try{return e.then}catch(e){return T.error=e,T}}function M(t,r,n){r.constructor===t.constructor&&n===w&&r.constructor.resolve===_?function(e,t){t._state===E?I(e,t._result):t._state===k?x(e,t._result):C(t,void 0,function(t){return U(e,t)},function(t){return x(e,t)})}(t,r):n===T?x(t,T.error):void 0===n?I(t,r):e(n)?function(e,t,r){s(function(e){var n=!1,o=function(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}(r,t,function(r){n||(n=!0,t!==r?U(e,r):I(e,r))},function(t){n||(n=!0,x(e,t))},e._label);!n&&o&&(n=!0,x(e,o))},e)}(t,r,n):I(t,r)}function U(e,t){var r;e===t?x(e,new TypeError("You cannot resolve a promise with itself")):"function"==typeof(r=t)||"object"==typeof r&&null!==r?M(e,t,P(t)):I(e,t)}function O(e){e._onerror&&e._onerror(e._result),R(e)}function I(e,t){e._state===S&&(e._result=t,e._state=E,0!==e._subscribers.length&&s(R,e))}function x(e,t){e._state===S&&(e._state=k,e._result=t,s(O,e))}function C(e,t,r,n){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+E]=r,o[i+k]=n,0===i&&e._state&&s(R,e)}function R(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,o=void 0,i=e._result,s=0;s<t.length;s+=3)n=t[s],o=t[s+r],n?A(r,n,o,i):o(i);e._subscribers.length=0}}function j(){this.error=null}var q=new j;function A(t,r,n,o){var i=e(n),s=void 0,a=void 0,u=void 0,c=void 0;if(i){if((s=function(e,t){try{return e(t)}catch(e){return q.error=e,q}}(n,o))===q?(c=!0,a=s.error,s=null):u=!0,r===s)return void x(r,new TypeError("A promises callback cannot return that same promise."))}else s=o,u=!0;r._state!==S||(i&&u?U(r,s):c?x(r,a):t===E?I(r,s):t===k&&x(r,s))}var F=0;function N(e){e[b]=F++,e._state=void 0,e._result=void 0,e._subscribers=[]}function G(e,t){this._instanceConstructor=e,this.promise=new e(D),this.promise[b]||N(this.promise),n(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?I(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&I(this.promise,this._result))):x(this.promise,new Error("Array Methods must be provided an Array"))}function L(e){this[b]=F++,this._result=this._state=void 0,this._subscribers=[],D!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof L?function(e,t){try{t(function(t){U(e,t)},function(t){x(e,t)})}catch(t){x(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return G.prototype._enumerate=function(){for(var e=this.length,t=this._input,r=0;this._state===S&&r<e;r++)this._eachEntry(t[r],r)},G.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===_){var o=P(e);if(o===w&&e._state!==S)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(r===L){var i=new r(D);M(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new r(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},G.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===S&&(this._remaining--,e===k?x(n,r):this._result[t]=r),0===this._remaining&&I(n,this._result)},G.prototype._willSettleAt=function(e,t){var r=this;C(e,void 0,function(e){return r._settledAt(E,t,e)},function(e){return r._settledAt(k,t,e)})},L.all=function(e){return new G(this,e).promise},L.race=function(e){var t=this;return n(e)?new t(function(r,n){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(r,n)}):new t(function(e,t){return t(new TypeError("You must pass an array to race."))})},L.resolve=_,L.reject=function(e){var t=new this(D);return x(t,e),t},L._setScheduler=function(e){i=e},L._setAsap=function(e){s=e},L._asap=s,L.prototype={constructor:L,then:w},L.polyfill=function(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=L},L.Promise=L,L},e.exports=n()}).call(this,r(7),r(8))},function(e,t){var r,n,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var u,c=[],l=!1,d=-1;function f(){l&&u&&(l=!1,u.length?c=u.concat(c):d=-1,c.length&&h())}function h(){if(!l){var e=a(f);l=!0;for(var t=c.length;t;){for(u=c,c=[];++d<t;)u&&u[d].run();d=-1,t=c.length}u=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new p(e,t)),1!==c.length||l||a(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){e.exports=r(10)},function(e,t,r){"use strict";var n=function(){function e(){}return e.isError=function(e){return"ProtocolError"===e.status||"InternalServerError"===e.status},e.isValidationError=function(e){return"ValidationError"===e.status},e.isSuccess=function(e){return"Success"===e.status},e}();t.ServiceResponses=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE",e}();t.HttpMethods=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.serialize=function(e,t){var r=[],n=!1;if("string"!=typeof e)for(var o in e)if(e.hasOwnProperty(o)){n=!0;var i=t?t+"."+o:o,s=e[o];if(Array.isArray(s))for(var a=0;a<s.length;a++)r.push(this.serialize(s[a],i+"["+a+"]"));else"object"==typeof s?r.push(this.serialize(s,i)):void 0!==s&&r.push(encodeURIComponent(i)+"="+encodeURIComponent(s))}return n||null==e||r.push(encodeURIComponent(t?t+"=":"")+encodeURIComponent(e)),r.filter(function(e){return e}).join("&")},e}();t.PayloadSerializer=new n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(14);t.RequestError=n.RequestError;var o=r(15);t.HttpError=o.HttpError;var i=r(16);t.Timeout=i.Timeout;var s=r(17);t.MultipleCallsToCreateError=s.MultipleCallsToCreateError},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(e,t,r){this.statusCode=e,this.name="HttpError",this.message=t,this.requestId=r;try{throw new Error}catch(e){this.stack=e.stack}}}();t.HttpError=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(e){this.name="Timeout",this.message=e;try{throw new Error}catch(e){this.stack=e.stack}}}();t.Timeout=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(e){if(this.stack=null,null==e)throw new Error("'settingsDiff' cannot be null");this.name="MultipleCallsToCreateError";var t=e.map(function(e){return e.key+": "+e.message}).join("; ");this.message="Multiple call for create. These settings are different from current: "+t}}();t.MultipleCallsToCreateError=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=function(){function e(e,t,r,n){this._pluses=/\+/g,this.MaxCookieExpirationDate=new Date(2038,1,19),this._navigator=e?e.navigator:navigator,this._document=e?e.document:document,this._domain=t,this._path=r,this._secure=n}return e.prototype.remove=function(e,t){return null!=this.tryGet(e,n.Raw)&&(this.set(e,"",-1,n.Raw,t),!this.tryGet(e,n.Raw))},e.prototype.tryGetJson=function(e){return this.tryGet(e,n.Json)},e.prototype.tryGet=function(e,t){var r=null;void 0===t&&(t=n.String);for(var o=this._document.cookie,i=o?o.split("; "):[],s=0,a=i.length;s<a;s++){var u=i[s].split("="),c=this.decode(u.shift(),t),l=u.join("=");if(e===c){r=this.read(l,t);break}}return r},e.prototype.setJson=function(e,t,r){return this.set(e,t,r,n.Json)},e.prototype.set=function(e,t,r,o,i){void 0===o&&(o=n.String),-1!==r&&this.remove(e);var s=null;null!=r&&"number"==typeof r?(s=new Date).setTime(+s+864e5*r):null!=r&&r instanceof Date&&(s=r);var a=null==i?this._domain:i;return a===this._document.domain&&(a=null),this._document.cookie=[this.encode(e,o),"=",this.stringifyCookieValue(t,o),null!=s?"; expires="+s.toUTCString():"","; path="+(null!=this._path?this._path:"/"),a?"; domain="+a:"",null!=this._secure&&this._secure?"; secure":""].join("")},e.prototype.removeAcrossBaseDomain=function(e){var t=this.getBaseDomain();if(t)for(var r=this._document.domain.split("."),n=t.substring(1).split("."),o=r.length-n.length+1-1;o>=0;o--){var i="."+r.slice(o).join(".");this.remove(e,i)}this.remove(e,this._document.domain)},e.prototype.isCookieEnabled=function(){try{if(this.isInternetExplorer()){this._document.cookie="testcookie=testcookie";var e=-1!==this._document.cookie.indexOf("testcookie=testcookie");return this.remove("testcookie"),e}e=!!this._navigator.cookieEnabled;return void 0!==this._navigator.cookieEnabled||e||(this._document.cookie="testcookie=testcookie",e=-1!==this._document.cookie.indexOf("testcookie=testcookie"),this.remove("testcookie")),e}catch(e){return!1}},e.prototype.isInternetExplorer=function(){var e=this._navigator.userAgent;if(void 0===e)return!1;var t=e.indexOf("MSIE "),r=e.indexOf("Trident/"),n=e.indexOf("Edge/");return t>0||r>0||n>0},e.prototype.read=function(e,t){t!=n.Raw&&t!=n.String||0!==e.indexOf('"')||(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{switch(e=t==n.Raw?e:decodeURIComponent(e.replace(this._pluses," ")),t){case n.Raw:case n.String:return e;case n.Json:return JSON.parse(e);default:throw new Error("Unknown format")}}catch(e){}},e.prototype.encode=function(e,t){switch(t){case n.Raw:return e;case n.Json:case n.String:return encodeURIComponent(e);default:throw new Error("Unknown format")}},e.prototype.decode=function(e,t){switch(t){case n.Raw:return e;case n.Json:case n.String:return decodeURIComponent(e);default:throw new Error("Unknown format")}},e.prototype.stringifyCookieValue=function(e,t){switch(t){case n.Raw:case n.String:return this.encode(String(e),t);case n.Json:return this.encode(JSON.stringify(e),t);default:throw new Error("Unknown format")}},e.prototype.setBaseDomain=function(){this._domain=this.getBaseDomain()},e.prototype.getBaseDomain=function(){return this._baseDomain||(this._baseDomain=this.computeBaseDomain()),this._baseDomain},e.prototype.computeBaseDomain=function(){if(!this.isCookieEnabled())return null;for(var e=this._document.domain?"."+this._document.domain:"",t=e.length-1;;){if(t<=0)return null;for(;t>=0&&"."!==e[t];)t--;var r=e.substr(t);if(this._document.cookie="domaintest=value; path=/; domain="+r,-1!==this._document.cookie.indexOf("domaintest=value"))return this._document.cookie="domaintest=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; domain="+r,r;t--}},e}();t.Manager=o,function(e){e[e.Json=0]="Json",e[e.String=1]="String",e[e.Raw=2]="Raw"}(n=t.Format||(t.Format={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="directCrm-session",o=function(){function e(e,t){this.MindboxDeviceUUIDName="mindboxDeviceUUID",this._window=t||window,this._cookieManager=e}return e.prototype.setSession=function(e){var t=new Date,r=new Date(t.getFullYear()+2,t.getMonth(),t.getDate());this._cookieManager.removeAcrossBaseDomain(n),this._cookieManager.setJson(n,e,r);try{this._window.localStorage[n]=JSON.stringify(e)}catch(e){}},e.prototype.getDeviceUUID=function(){var e=this.tryGetDeviceUUID();if(null==e)throw new Error("DeviceUUID not set");return e},e.prototype.tryGetDeviceUUID=function(){var e=this.tryGetDeviceUUIDFromLocalStorage();return e||(e=this._cookieManager.tryGet(this.MindboxDeviceUUIDName)),e},e.prototype.tryGetDeviceUUIDFromLocalStorage=function(){try{return this._window.localStorage[this.MindboxDeviceUUIDName]}catch(e){return null}},e.prototype.setDeviceUUID=function(e){this._cookieManager.removeAcrossBaseDomain(this.MindboxDeviceUUIDName),this._cookieManager.set(this.MindboxDeviceUUIDName,e,this._cookieManager.MaxCookieExpirationDate),this.setSession({deviceGuid:e}),this.setDeviceUUIDToLocalStorage(e),this.removeOldLocalStorage()},e.prototype.setDeviceUUIDToLocalStorage=function(e){try{this._window.localStorage[this.MindboxDeviceUUIDName]=e}catch(e){}},e.prototype.removeOldLocalStorage=function(){try{this._window.localStorage.removeItem(n)}catch(e){}},e.prototype.isUsingDeviceUUIDInLocalStorage=function(){try{return!!this._window.localStorage[this.MindboxDeviceUUIDName]}catch(e){return!1}},e.prototype.deviceUUIDIsSet=function(){return!!this._cookieManager.tryGet(this.MindboxDeviceUUIDName)},e}();t.CustomerSessionStorage=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(13),o=r(21),i=function(){function e(){this.logger=new o.LoggerStub}return e.prototype.logError=function(e,t){if(console.error(e),e instanceof n.Timeout)this.logger.trackEvent("Timeout",t);else if(e instanceof n.HttpError){400!==e.statusCode&&401!==e.statusCode&&403!==e.statusCode&&this.logger.trackException(e)}else{if(e instanceof n.MultipleCallsToCreateError)return;this.logger.trackException(e)}},e.prototype.trackEvent=function(e,t){this.logger.trackEvent(e,t)},e}();t.TrackerLogger=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.trackException=function(e){},e.prototype.trackEvent=function(e){},e}();t.LoggerStub=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1);t.compareSettings=function(e,t){var r,i,s=new Array;try{for(var a=n.__values(Object.keys(e)),u=a.next();!u.done;u=a.next()){var c=u.value,l=o(c,e,t);null!=l&&s.push(l)}}catch(e){r={error:e}}finally{try{u&&!u.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return 0===s.length?null:s};var o=function(e,t,r){var n;switch(e){case"serviceDomain":n=null;break;case"redirectedFrom":n=i(t[e],r[e])?null:"redirectedFrom objects are different";break;default:n=t[e]===r[e]?null:t[e]+" !== "+r[e]}return null==n?null:{key:e,message:n}},i=function(e,t){return e.requestUrl===t.requestUrl&&e.referrerUrl===t.referrerUrl};t.getEffectiveApiUri=function(e){if(null==e)throw new Error("'settings' cannot be null");return(e.useHttp?"http":"https")+"://"+(null!=e.serviceDomain?e.serviceDomain:"api.mindbox.ru")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(6),o=r(24),i=r(3),s=function(){function e(e,t,r,o){if(this.loadingModulePromise=null,this.previousCommandPromise=n.Promise.resolve(),this.isSupportedByBrowserCommand=function(e,t){return"isSupportedByBrowser"===e},null==e)throw new Error("'trackerSettings' cannot be null");if(null==t)throw new Error("'sessionStorage' cannot be null");if(null==r)throw new Error("'deviceUUIDObtainingPromiseProvider' cannot be null");if(null==o)throw new Error("'logger' cannot be null");this.trackerSettings=e,this.sessionStorage=t,this.deviceUUIDObtainingPromiseProvider=r,this.logger=o}return e.prototype.tryGetModuleCommand=function(e){var t=e.indexOf(".");if(t<=0)return null;var r=e.substr(0,t);return o.moduleExists(r)?{moduleName:r,command:e.substr(t+1)}:null},e.prototype.invokeModule=function(e,t){var r=this,n=e.moduleName,i=e.command;if(t instanceof Array&&t.length>1)throw new Error("[Mindbox.SDK] <"+n+"> Too many arguments for command.");var s=t instanceof Array?t[0]:t,a=o.getModuleInfo(n).isSupportedByBrowser();if(this.isSupportedByBrowserCommand(i,s)){if(null==s||"function"!=typeof s.callback)throw new Error("[Mindbox.SDK] <"+n+'> Callback for command "isSupportedByBrowser" not set.');s.callback(a)}else a&&this.moduleThen(n,function(e){if(void 0===e[i])throw new Error("[Mindbox.SDK] <"+n+'> Unknown command "'+i+'".');return e[i](r.trackerSettings,r.sessionStorage.getDeviceUUID(),s)})},e.prototype.moduleThen=function(e,t){var r=this,s=this.deviceUUIDObtainingPromiseProvider();if(null==s)throw new Error("Previous request promise is expected to be set. 'mindbox(\"create\")' is expected to be called ahead of every other command");if(null==this.loadingModulePromise){var a=new n.Promise(function(t,n){o.loadModule(r.trackerSettings,e,i.version,r.logger).then(function(e){return t(e)},function(e){return n(e)})});this.loadingModulePromise=n.Promise.all([a,s]).then(function(e){return e[0]},function(e){return n.Promise.reject(e)})}this.loadingModulePromise.then(function(e){r.previousCommandPromise=r.previousCommandPromise.then(function(){return new n.Promise(function(n){t(e).then(n,function(e){r.logger.logError(e),n()})})})},function(e){return r.logger.logError(e)})},e}();t.ModuleManager=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=r(25),i=r(22);r(26),function(e){e.NotLoaded="NotLoaded",e.Loading="Loading",e.Loaded="Loaded",e.Failed="Failed"}(n||(n={}));var s,a={webpush:(s=o.webpushModuleInfo,{moduleInfo:s,loadingState:n.NotLoaded,loadingPromise:null,loadingError:null})},u=function(e){var t=a[e];if(null==t)throw new Error("[Mindbox.SDK] <core> Module "+e+" is not registered.");return t};t.getModuleInfo=function(e){return u(e).moduleInfo},t.moduleExists=function(e){return e in a},t.loadModule=function(e,t,r,o){var s=u(t);switch(s.loadingState){case n.Loaded:return Promise.resolve(l(s.moduleInfo));case n.Loading:return s.loadingPromise;case n.NotLoaded:return s.loadingState=n.Loading,s.loadingPromise=new Promise(function(a,u){var d=document.createElement("script");d.src=i.getEffectiveApiUri(e)+"/scripts/modules/"+s.moduleInfo.src+"?version="+r,d.async=!0;var f=function(){return null==c(s.moduleInfo)},h=function(){try{s.loadingState=n.Loaded,a(l(s.moduleInfo))}catch(e){s.loadingState=n.Failed,s.loadingError=e,u(e)}},p={"Module name":s.moduleInfo.name};d.onload=function(){f()?(o.trackEvent("Loading module in another loop",p),setTimeout(function(){f()?o.trackEvent("Couldn't load module in another loop",p):o.trackEvent("Have loaded module in another loop",p),h()},5e3)):h()},d.onerror=function(){u(new Error("[Mindbox.SDK] <core> There was an error during loading of '"+t+"' module"))};try{document.head.insertAdjacentElement("beforeend",d)}catch(e){u(e)}}),s.loadingPromise;case n.Failed:return s.loadingPromise;default:throw new Error("[Mindbox.SDK] <core> Unknown module loading state "+s.loadingState+".")}};var c=function(e){return window.mindbox[e.name]},l=function(e){var t=c(e);if(null==t)throw new Error("[Mindbox.SDK] <core> Expected module not found in mindbox["+e.name+"]");return t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.webpushModuleInfo={name:"webpush",src:"webpush.js",version:"1.12.3",isSupportedByBrowser:function(){return navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")&&("https:"==window.location.protocol||["localhost","127.0.0.1",""].some(function(e){return e===window.location.hostname}))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.tryGetTimeZone=function(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return null}},e}();t.IanaTimeZoneProvider=n}]);
//# sourceMappingURL=tracker.js.map
